{"project":{"commands":[{"father":"trycatch","command":"","id":"791cf817-563a-4f8a-a892-2f5c13f8a36e","group":"logic","mode_live":false,"children":[{"father":"setVar","command":"False","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"5e12baab-e255-ea0d-9a48-fd92d4649a9b","group":"system","mode_live":false,"var":"gblBandProceso","children":[],"else":[],"line":"1.1","execute":2,"index":0,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"0.0010018348693847656","extra":[]},{"father":"module","command":"{\"module_name\":\"Vortex-Utils\",\"module\":\"sendText\",\"path\":\"{gblRutaLogs}\",\"infoType\":\"info\",\"text\":\"Se va a iniciar el aplicativo de Siesa 8.5.\"}","index":1,"execute_debugg":0,"img":"","screenshot":"","line":"1.2","description":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","module":"sendText","id":"b83d9f90-44c6-67a9-64cc-6513db8480af","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":"","time":"0.06496071815490723","extra":[]},{"father":"execScriptPython","command":"import pyautogui\nfrom time import sleep\n\nfrom VortexLibrary import logger \nlogger.log_path = \"{gblRutaLogs}\"\nlogger.task_name = tmp_global_obj[\"profile\"][\"name\"]\n\nlogger.info(\"Esperando 1 segundo antes de ejecutar pyautogui.hotkey('win', 'd').\")\nsleep(1)  # (Opcional) Te da 1 seg antes de ejecutar\nlogger.info(\"Enviando hotkey 'win' + 'd' para mostrar el escritorio.\")\npyautogui.hotkey('win', 'd')","index":2,"execute_debugg":0,"img":"","screenshot":"","line":"1.3","description":"script para minimizar todas las ventanas actuales","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"2ff61e90-2c0d-9eb4-1c00-11eba88d6842","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":"","time":"1.1038379669189453","extra":[]},{"father":"execScriptPython","command":"global logger\n\nfrom VortexLibrary import logger \nlogger.log_path = \"{gblRutaLogs}\"\nlogger.task_name = tmp_global_obj[\"profile\"][\"name\"]\n\nruta = GetVar('loc003RutaEjecutable')\n\ndef ejecutar_exe(ruta_exe):\n    import os\n    import subprocess\n\n    # Verifica si el ejecutable existe en la ruta obtenida\n    if not os.path.exists(ruta_exe):\n        msg = f\"El archivo no existe en la ruta: {ruta_exe}\"\n        print(msg)\n        logger.warning(msg)\n        return\n    \n    try:\n        # Ejecutamos el ejecutable .exe de siesa 8.5\n        logger.info(f\"Intentando ejecutar: {ruta_exe}\")\n        subprocess.Popen(ruta_exe, shell=True)\n        msg_success = f\"Ejecutando: {ruta_exe}\"\n        print(msg_success)\n        logger.info(msg_success)\n    except Exception as e:\n        msg_error = f\"Error al ejecutar el archivo: {e}\"\n        print(msg_error)\n        logger.warning(msg_error)\n        raise e\n\n\n# Ejecutamos la función creada\nejecutar_exe(ruta)\n","index":3,"execute_debugg":0,"img":"","screenshot":"","line":"1.4","description":"Script diseñado para ejecutar el ejecutable de siesa 8.5","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"11b41548-f3b0-c1b8-7b10-217e8309faa1","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":"","time":"0.0","extra":[]},{"father":"wait","command":"3","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"f9c8b549-af85-eb6c-42c6-ba1b161756a9","group":"system","mode_live":false,"children":[],"else":[],"line":"1.5","execute":2,"index":4,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"2.995006561279297","extra":[]},{"father":"execScriptPython","command":"nameVentana = GetVar('loc003NombreVetana')\n\ndef enfocar_ventana(nombre):\n    import pygetwindow as gw\n    from time import sleep\n\n    from VortexLibrary import logger \n    logger.log_path = \"{gblRutaLogs}\"\n    logger.task_name = tmp_global_obj[\"profile\"][\"name\"]\n\n    logger.info(f\"Buscando ventanas abiertas para encontrar coincidencia con el nombre: '{nombre}'\")\n    ventanas = gw.getAllTitles()\n    logger.info(f\"Títulos de ventanas encontradas: {ventanas}\")\n\n    coincidencias = [v for v in ventanas if nombre.lower() in v.lower() and v.strip() != \"\"]\n\n    if not coincidencias:\n        msg = f\"No se encontró ninguna ventana con el nombre que contenga: '{nombre}'\"\n        print(msg)\n        logger.warning(msg)\n        return\n\n    ventana = gw.getWindowsWithTitle(coincidencias[0])[0]\n    logger.info(f\"Ventana encontrada con coincidencia: '{ventana.title}'. Intentando enfocar.\")\n\n    ventana.activate()\n    sleep(0.5)\n\n    msg_success = f\"Ventana enfocada: {ventana.title}\"\n    logger.info(msg_success)\n    print(msg_success)\n\n\nenfocar_ventana(nameVentana)","index":5,"execute_debugg":0,"img":"","screenshot":"","line":"1.6","description":"enfoncamos la venta de siesa 8.5 ","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"d35d18bc-2a8d-b8ca-d532-30462da9739e","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":"","time":"0.4991791248321533","extra":[]},{"father":"wait","command":"3","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"58c12eaa-3eec-4dca-f7f1-eed5886bc3c5","group":"system","mode_live":false,"children":[],"else":[],"line":"1.7","execute":2,"index":6,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"3.0106911659240723","extra":[]},{"father":"execScriptPython","command":"nameVentana = GetVar('loc003NombreVetana')\n\ndef maximizar_ventana(nombre):\n    import pygetwindow as gw\n    from time import sleep\n\n    from VortexLibrary import logger \n    logger.log_path = \"{gblRutaLogs}\"\n    logger.task_name = tmp_global_obj[\"profile\"][\"name\"]\n\n    logger.info(f\"Buscando ventanas abiertas para encontrar coincidencia con el nombre: '{nombre}'\")\n    ventanas = gw.getAllTitles()\n    logger.info(f\"Títulos de ventanas encontradas: {ventanas}\")\n\n    coincidencias = [v for v in ventanas if nombre.lower() in v.lower() and v.strip() != \"\"]\n\n    if not coincidencias:\n        msg = f\"No se encontró ninguna ventana con el nombre que contenga: '{nombre}'\"\n        print(msg)\n        logger.warning(msg)\n        return\n\n    ventana = gw.getWindowsWithTitle(coincidencias[0])[0]\n    logger.info(f\"Ventana encontrada con coincidencia: '{ventana.title}'. Intentando maximizar y enfocar.\")\n\n    ventana.activate()\n    sleep(0.3)  # pequeña pausa para asegurar el enfoque\n    ventana.maximize()\n\n    msg_success = f\"Ventana maximizada: {ventana.title}\"\n    logger.info(msg_success)\n    print(msg_success)\n\nmaximizar_ventana(nameVentana)\n","index":7,"execute_debugg":0,"img":"","screenshot":"","line":"1.8","description":"maximisamos la venta de siesa 8.5","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"6c8a0ef1-3a77-8e60-a1f7-0d3a56c2950a","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":"","time":"0.3119995594024658","extra":[]},{"father":"wait","command":"3","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"2f34a246-8596-d1f7-ecb3-5f07f4cd35c8","group":"system","mode_live":false,"children":[],"else":[],"line":"1.9","execute":2,"index":8,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"3.010782480239868","extra":[]},{"father":"execRocketBotDB","command":"004_ObtenerInformacionDePantallaSiesa8.5","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"46e504a7-d0c5-235e-8f90-dc707abb885d","group":"scripts","mode_live":false,"children":[],"else":[],"line":"1.10","execute":2,"index":9,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"3.3540594577789307","extra":[]},{"father":"evaluateIf","command":"not {gblBandProceso}","index":10,"execute_debugg":0,"img":"","screenshot":"","line":"1.11","description":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"077d1075-b12c-9965-d8a7-3cf88dbd0dd0","group":"logic","mode_live":false,"children":[{"father":"module","command":"{\"module_name\":\"Vortex-Utils\",\"module\":\"sendText\",\"path\":\"{gblRutaLogs}\",\"infoType\":\"warning\",\"text\":\"Ocurrio un error al obtener informacion de pantalla de Siesa.\"}","index":0,"execute_debugg":0,"img":"","screenshot":"","line":"1.11.1","description":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","module":"sendText","id":"9d3e0485-e26b-5593-3777-6e8eeda29990","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":""},{"father":"stop","command":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"327c16a2-4dd1-a280-d415-e85ce8581d87","group":"scripts","mode_live":false,"children":[],"else":[],"line":"1.11.2","execute":2,"index":1,"execute_debugg":0,"img":"","message":"","screenshot":"","extra":[]}],"else":[],"execute":2,"message":"","time":"0.0","extra":{"res":false}},{"father":"execScriptPython","command":"def es_pantalla_login(texto):\n    \"\"\"\n    Valida si el texto recibido corresponde a la pantalla de login de SIESA.\n\n    Criterios:\n      - Debe estar la frase \"Codigo de Usuario\".\n      - Debe estar \"SIESA\" (puede estar en varias posiciones).\n      - Debe haber líneas de encabezado típicas como \"autoriza el uso de esta copia\"\n    \"\"\"\n    from VortexLibrary import logger\n\n    logger.log_path = \"{gblRutaLogs}\"\n    logger.task_name = tmp_global_obj[\"profile\"][\"name\"]\n\n    if not isinstance(texto, str):\n        logger.warning(\"El valor recibido para analizar pantalla de login no es string.\")\n        return False\n\n    logger.info(\"Validando pantalla de login SIESA...\")\n    patrones_requeridos = [\n        \"codigo de usuario\",  # campo loginz\n        \"codigo de seguridad\",  # campo password\n        \"siesa\",  # nombre producto\n        \"autoriza el uso de esta copia\",  # leyenda de legalidad\n        \"serial:\",  # info de copia\n    ]\n    texto_min = texto.lower()\n\n    for patron in patrones_requeridos:\n        if patron not in texto_min:\n            logger.info(f\"No se encontró el patrón requerido en pantalla: '{patron}'\")\n            return False\n        else:\n            logger.info(f\"Patrón encontrado: '{patron}'\")\n\n    logger.info(\"Pantalla de login SIESA detectada exitosamente.\")\n    return True\n\n\n# Ejemplo de uso:\nrespuesta_terminal = \"\"\"{gblInfoPantalla}\"\"\"\n\nresultado = es_pantalla_login(respuesta_terminal)\n\nif resultado:\n    logger.info(\"Detectada pantalla de login de SIESA.\")\n    SetVar('loc003PantallaLogin', 'True')\nelse:\n    logger.info(\"No se detecta pantalla de login.\")\n    SetVar('loc003PantallaLogin', 'False')","index":11,"execute_debugg":0,"img":"","screenshot":"","line":"1.12","description":"Codigo para validar si es pantalla de login.","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"b112488f-1d45-bb16-d707-bf2f8f67df37","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":""},{"father":"evaluateIf","command":"not {loc003PantallaLogin}","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"426dceae-93ce-a7c3-be05-ddf332727196","group":"logic","mode_live":false,"children":[{"father":"module","command":"{\"module_name\":\"Vortex-Utils\",\"module\":\"sendText\",\"path\":\"{gblRutaLogs}\",\"infoType\":\"warning\",\"text\":\"No se pudo validar la pantalla de Login.\"}","index":0,"execute_debugg":0,"img":"","screenshot":"","line":"1.13.1","description":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","module":"sendText","id":"146e1044-5c18-3a93-5642-8634a0cc7495","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":""},{"father":"setVar","command":"False","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"14b64318-085d-968e-b718-6a0c77d38766","group":"system","mode_live":false,"var":"gblBandProceso","children":[],"else":[],"line":"1.13.2","execute":2,"index":1,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"0.0009982585906982422","extra":[]},{"father":"stop","command":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"61b96818-9768-c731-d0c5-f3618fea41ac","group":"scripts","mode_live":false,"children":[],"else":[],"line":"1.13.3","execute":2,"index":2,"execute_debugg":0,"img":"","message":"","screenshot":"","extra":[]}],"else":[],"line":"1.13","execute":2,"index":12,"execute_debugg":0,"img":"","message":"","screenshot":""},{"father":"module","command":"{\"module_name\":\"Vortex-Utils\",\"module\":\"sendText\",\"path\":\"{gblRutaLogs}\",\"infoType\":\"info\",\"text\":\"Se abrio el aplicativo correctamente.\"}","index":13,"execute_debugg":0,"img":"","screenshot":"","line":"1.14","description":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","module":"sendText","id":"5af6ff3a-f147-325a-e567-0e1fda9863ad","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":""},{"father":"setVar","command":"True","index":14,"execute_debugg":0,"img":"","screenshot":"","line":"1.15","description":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"8031df2f-282f-390b-bb25-292b6447ed93","group":"system","mode_live":false,"var":"gblBandProceso","children":[],"else":[],"execute":2,"message":"","time":"0.0","extra":[]}],"else":[{"father":"module","command":"{\"module_name\":\"Vortex-Utils\",\"module\":\"sendText\",\"path\":\"{gblRutaLogs}\",\"infoType\":\"error\",\"text\":\"Ocurrio un error al iniciar el aplicativo de SIesa 8.5.\"}","index":0,"execute_debugg":0,"img":"","screenshot":"","line":"1.1","description":"","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","module":"sendText","id":"a3c008bd-5cbe-8a49-40fd-000f84a336b4","group":"scripts","mode_live":false,"children":[],"else":[],"execute":2,"message":"","time":"0.0","extra":[]},{"father":"setVar","command":"False","stop_onerror":false,"run_onerror":false,"stop_robot_onerror":false,"run_onerror_robot":"","run_when":"True","id":"c89d083d-0bd9-af96-ea39-2ee4cc88e156","group":"system","mode_live":false,"var":"gblBandProceso","children":[],"else":[],"line":"1.2","execute":2,"index":1,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"0.0","extra":[]}],"line":1,"execute":2,"index":0,"execute_debugg":0,"img":"","message":"","screenshot":"","time":"0.0009982585906982422","extra":{"res":false}}],"ifs":[],"modules":[{"name":"Vortex-Utils","status":"Installed","version":"1.0"},{"name":"clipboard","status":"Installed","version":"3.2.1","last_version":"3.2.1"}],"profile":{"log_destination":"base_path","deactivate_log":false,"log_path":null,"name":"003_AbrirSiesa8.5","description":""},"vars":[{"name":"gblBandProceso","data":"False","type":"string","category":"Prueba","disabled":true},{"name":"gblRutaLogs","data":"C:/Users/administrator.ENERGIZANDO/Documents/01_RecuperacionSoportes/Process/logs/Prueba.log","type":"string","category":"Prueba","status":"0","constant":false,"defaultValue":"","disabled":true},{"name":"loc003RutaEjecutable","data":"C:/Users/administrator.ENERGIZANDO/Desktop/SISTEMA UNO CLOUD.lnk","type":"string","category":"Local","status":"0","constant":false,"defaultValue":"","disabled":false},{"name":"loc003NombreVetana","data":"Sistema Uno","type":"string","category":"Local","status":"0","constant":false,"defaultValue":"","disabled":false},{"name":"loc003PantallaLogin","data":"False","type":"string","category":"Local","status":"0","constant":false,"defaultValue":"","disabled":false}],"expose":{"title":{"en":"003_AbrirSiesa8.5 expose","es":"003_AbrirSiesa8.5 expose","pr":"003_AbrirSiesa8.5 expose"},"description":{"en":"","es":"","pr":""},"form":[]}}}