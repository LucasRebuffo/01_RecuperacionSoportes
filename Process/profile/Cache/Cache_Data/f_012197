var Re=Object.defineProperty;var De=(N,h,E)=>h in N?Re(N,h,{enumerable:!0,configurable:!0,writable:!0,value:E}):N[h]=E;var P=(N,h,E)=>(De(N,typeof h!="symbol"?h+"":h,E),E);import{g as Ie,z as Le,Y as $e}from"./bootstrap-vue-next.667fb585.js";import{e as Fe,r,f as te,g as Ge,h as me,i as ze,o as B,c as S,b as a,j as t,w as y,a as l,k as _,v as le,d as b,l as T,n as C,m as pe,p as A,t as L,q as qe}from"./entry.5c5f6add.js";import{B as We}from"./Breadcrumb.930ec479.js";import{_ as oe}from"./ModalComponent.vue.58c1e7f2.js";import{_ as Xe}from"./CardHeader.vue.6f5a0807.js";import{f as $}from"./fetch-wrapper.d0af2f5c.js";import{s as F}from"./vue-multiselect.esm.604847d6.js";import{s as Ye,p as je}from"./perPageStorer.7342e74b.js";import{_ as ve}from"./ToastComponent.vue.6c820df6.js";/* empty css                        *//* empty css                    */import"./nuxt-link.851df10c.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./composables.671b84f7.js";const He={class:"container-fluid"},Ze={class:"row"},Je={class:"col-md-6"},Ke={class:"form-label",for:"new-asset-name"},Oe={class:"col-md-6"},Qe={class:"row mt-4"},es={class:"col"},ss={class:"row mt-4"},ts={class:"col-md-6"},ls={class:"col-md-6"},os={class:"row mt-4"},as={class:"col-md-12"},ns=["disabled"],is={class:"row"},rs={class:"col"},ds={class:"text-break"},us={class:"text-black"},cs=["disabled"],ms={class:"row"},ps={class:"col-md-6"},vs={class:"form-label",for:"edit-asset-name"},fs={class:"col-md-6"},bs={class:"row mt-4"},As={class:"col"},gs={class:"row mt-4"},ys={class:"col-md-6"},ws={class:"col-md-6"},_s={class:"row mt-4"},hs={class:"col-md-12"},xs=["disabled"],ks={class:"row"},Vs={class:"col"},Cs={class:"fixed-button active"},Es=["disabled"],Ms={class:"row mt-2"},Us={class:"col"},Ps={class:"card bigCard m-shadow"},Bs=["disabled"],Ss={class:"card-body"},Ts={class:"row"},Ns={class:"col"},Rs=["readonly"],Ds={class:"row mt-3"},Is={class:"col"},Ls={key:0,class:"text-center"},$s={key:1,class:"table-responsive"},Fs={class:"text-center"},Gs={href:"#",class:"btn btn-sm btn-default dropdown-toggle border border-dark","data-bs-toggle":"dropdown"},zs={class:"dropdown-menu dropdown-menu-end"},qs={class:"dropdown text-start"},Ws=["onClick"],Xs=["onClick"],j=65e3,fe="assets",Ys=10,rt=Fe({__name:"index",setup(N){const{$bootstrap:h}=qe(),E=[{icon:["fas","house"],text:"",href:"/"},{text:"Assets",active:!0}],ae=r(""),G=s=>{ae.value=s;let e=document.getElementById("assetToast");new h.Toast(e,{autohide:!1}).show()};let k=r(10),R=r(1);const be=te(()=>{var s;return((s=ne.value)==null?void 0:s.length)||0});let z=r("");const ne=te(()=>{var s;return R.value=1,((s=ie.value)==null?void 0:s.filter(e=>{var i;return e.name.toLowerCase().includes((i=z.value)==null?void 0:i.toLowerCase())}))||[]}),c=r({loadingAssets:!1,deletingAsset:!1,creatingAsset:!1,editingAsset:!1});let ie=r([]),H=r([]);Ge(()=>{k.value=Ye(fe,Ys),Z(),Ae(),ge()});let Z=()=>{c.value.loadingAssets=!0,$.post("/assets/list").then(s=>{ie.value=(s==null?void 0:s.data)||[]}).catch(s=>{var e;G(((e=s==null?void 0:s.data)==null?void 0:e.message)||"Error fetching assets")}).finally(()=>{c.value.loadingAssets=!1})},Ae=()=>{$.post("/process/list").then(s=>{H.value=(s==null?void 0:s.data)||[]}).catch(s=>{let e=document.getElementById("processToast");new h.Toast(e,{autohide:!1}).show()})},ge=()=>{$.post("/users/list").then(s=>{W.value=(s==null?void 0:s.data)||[]}).catch(s=>{G("Error fetching users")})},ye=s=>s.type==="password"?"********":we(s.value);const we=s=>(s==null?void 0:s.length)>500?(s==null?void 0:s.substring(0,500))+"...":s;let _e=s=>s.type==="password"?"Password":s.type==="text"?"General":s.type;class J{constructor(e,i,x,p,U,o){P(this,"value");P(this,"type");P(this,"name");P(this,"process");P(this,"instance");P(this,"id");this.value=e,this.type=i,this.name=x,this.process=p,this.instance=U,this.id=o}reset(){this.value=null,this.type="text",this.name=null,this.process=void 0,this.instance=void 0,this.id=void 0}}let n=r(new J("","text",null)),K=r(!1),he=r(null),xe=s=>{n.value=new J(s.value,s.type,s.name,s.process,s.instance,s.id),K.value=!0},ke=async()=>{c.value.deletingAsset=!0,await Ve()&&(re(),Z()),c.value.deletingAsset=!1},Ve=async()=>{try{return await $.post("/assets/delete",{id:n.value.id}),!0}catch{return G("Error deleting asset"),!1}},re=()=>{K.value=!1,n.value.reset()},D=r(!1);const Ce=async()=>{D.value=!0};let Ee=r(null),d=r(new J(null,"text",null)),M=r(null),w=r(null),de=()=>{D.value=!1,d.value.reset(),M.value=null,w.value=null,q.value=[]};async function Me(){c.value.creatingAsset=!0,await Ue()&&(de(),Z()),c.value.creatingAsset=!1}let Ue=async()=>{var s,e,i,x;try{const p={name:d.value.name,type:d.value.type,value:d.value.value,process_id:((s=M.value)==null?void 0:s.id)||0,instance_id:((e=w.value)==null?void 0:e.id)||0,users:((i=q.value)==null?void 0:i.map(U=>U.id))||[]};return await $.post("/assets/add",p),!0}catch(p){return console.log(p),G(((x=p==null?void 0:p.data)==null?void 0:x.message)||"Error creating asset"),!1}};const O=r([]);me(()=>M,s=>{var e;s.value?O.value=(e=s.value)==null?void 0:e.instances:O.value=[]},{deep:!0});const Pe=te(()=>{var s;return Q(d.value.name)&&d.value.value!==null&&((s=d.value.value)==null?void 0:s.trim())!==""&&d.value.value.length<=j}),Q=s=>{const e=/^[a-zA-Z0-9_]*$/;return(s==null?void 0:s.trim().length)>2&&e.test(s)},ee=r([]);let se=r(!1),Be=r(null),V=r(null),g=r(null);const ue=r("");let Se=async s=>{n.value=new J(s.value,s.type,s.name,s.process,s.instance,s.id),ue.value=s.name,V.value=(s==null?void 0:s.process)||null,g.value=(s==null?void 0:s.instance)||null,I.value=(s==null?void 0:s.users)||[],se.value=!0},Te=async()=>{c.value.editingAsset=!0,await Ne()&&(ce(),Z()),c.value.editingAsset=!1};const I=r([]),q=r([]),W=r([]);let Ne=async()=>{var s,e,i,x;try{const p={id:n.value.id,name:n.value.name,type:n.value.type,value:n.value.value,process_id:((s=V.value)==null?void 0:s.id)||0,instance_id:((e=g.value)==null?void 0:e.id)||0,users:((i=I.value)==null?void 0:i.map(U=>U.id))||[]};return await $.post("/assets/edit",p),!0}catch(p){return G(((x=p==null?void 0:p.data)==null?void 0:x.message)||"Error editing asset"),!1}},ce=()=>{se.value=!1,n.value.reset(),ue.value="",V.value=null,g.value=null,I.value=[]};return me(()=>V,s=>{var e;s.value?ee.value=((e=H.value.find(i=>i.id===s.value.id))==null?void 0:e.instances)||[]:ee.value=[]},{deep:!0}),(s,e)=>{const i=ze("font-awesome-icon"),x=Ie,p=Le,U=$e;return B(),S("div",He,[a(ve,{text:t(ae),variant:"danger",id:"assetToast"},null,8,["text"]),a(ve,{text:"Error getting processes",variant:"danger",id:"processToast"}),a(oe,{ref_key:"createAssetModalRef",ref:Ee,show:t(D),header:{title:"Add asset",theme:"green"},type:"confirmation","modal-class":"modal-lg",onCancel:e[10]||(e[10]=()=>t(de)())},{afterFooter:y(()=>[l("button",{ref:"cancelButton",class:"btn btnSuccessBorderLight",onClick:e[9]||(e[9]=o=>Me()),disabled:t(c).creatingAsset||!t(Pe)},[_(a(i,{icon:["fas","spinner"],spin:""},null,512),[[le,t(c).creatingAsset]]),e[37]||(e[37]=b(" Create "))],8,ns)]),default:y(()=>{var o,v,f,X,Y,u;return[l("div",Ze,[l("div",Je,[l("label",Ke,[e[30]||(e[30]=b("Asset name: ")),a(i,{icon:["fas","circle-question"],title:"Asset name must be at least 3 characters long, alphanumeric and _ only."})]),_(l("input",{"onUpdate:modelValue":e[0]||(e[0]=m=>t(d).name=m),id:"new-asset-name",type:"text",class:C(["form-control",{"is-invalid":((o=t(d))==null?void 0:o.name)!==null&&!Q(t(d).name)}]),autocomplete:"off"},null,2),[[T,t(d).name]])]),l("div",Oe,[e[32]||(e[32]=l("label",{class:"form-label",for:"new-asset-type"},"Asset type:",-1)),_(l("select",{id:"new-asset-type","onUpdate:modelValue":e[1]||(e[1]=m=>t(d).type=m),class:"form-control"},e[31]||(e[31]=[l("option",{value:"text"},"General",-1),l("option",{value:"password"},"Password",-1)]),512),[[pe,t(d).type]])])]),l("div",Qe,[l("div",es,[e[33]||(e[33]=l("label",{class:"form-label",for:"new-asset-value"},"Asset value:",-1)),t(d).type==="password"?_((B(),S("input",{key:0,id:"new-asset-value","onUpdate:modelValue":e[2]||(e[2]=m=>t(d).value=m),type:"password",class:C(["form-control",{"is-invalid":t(d).value!==null&&((v=t(d).value)==null?void 0:v.trim())===""}]),autocomplete:"off"},null,2)),[[T,t(d).value]]):_((B(),S("textarea",{key:1,id:"new-asset-value","onUpdate:modelValue":e[3]||(e[3]=m=>t(d).value=m),class:C(["form-control",{"is-invalid":((X=(f=t(d))==null?void 0:f.value)==null?void 0:X.length)>j}])},null,2)),[[T,t(d).value]]),l("small",{class:C(["form-text",((u=(Y=t(d))==null?void 0:Y.value)==null?void 0:u.length)>j?"text-danger":"text-muted"])}," 65k characters max. ",2)])]),l("div",ss,[l("div",ts,[e[34]||(e[34]=l("label",{class:"form-label",for:"processCreateAsset"},"Process:",-1)),a(t(F),{modelValue:t(M),"onUpdate:modelValue":e[4]||(e[4]=m=>A(M)?M.value=m:M=m),id:"processCreateAsset",options:t(H),multiple:!1,taggable:!1,"close-on-select":!0,placeholder:"--All--",label:"name","track-by":"id",onSelect:e[5]||(e[5]=m=>A(w)?w.value=null:w=null),onRemove:e[6]||(e[6]=m=>A(w)?w.value=null:w=null)},null,8,["modelValue","options"])]),l("div",ls,[e[35]||(e[35]=l("label",{class:"form-label",for:"instanceCreateAsset"},"Instance:",-1)),a(t(F),{modelValue:t(w),"onUpdate:modelValue":e[7]||(e[7]=m=>A(w)?w.value=m:w=m),id:"instanceCreateAsset",options:t(O),multiple:!1,taggable:!1,"close-on-select":!0,placeholder:"--All--",label:"name","track-by":"id"},null,8,["modelValue","options"])])]),l("div",os,[l("div",as,[e[36]||(e[36]=l("label",{class:"form-label",for:"processCreateAsset"},"Users:",-1)),a(t(F),{modelValue:t(q),"onUpdate:modelValue":e[8]||(e[8]=m=>A(q)?q.value=m:null),id:"processCreateAsset",options:t(W),multiple:!0,taggable:!0,"close-on-select":!0,placeholder:t(W).length>0?"--All--":"No users available or no permitted to access them",label:"name","track-by":"id"},null,8,["modelValue","options","placeholder"])])])]}),_:1},8,["show"]),a(oe,{ref_key:"deleteAssetModalRef",ref:he,show:t(K),header:{title:"Delete asset",theme:"red"},type:"delete","modal-class":"modal-md",onCancel:e[12]||(e[12]=()=>t(re)())},{afterFooter:y(()=>[l("button",{ref:"cancelButton",class:"btn btnErrorBorderLight",onClick:e[11]||(e[11]=o=>t(ke)()),disabled:t(c).deletingAsset},[_(a(i,{icon:["fas","spinner"],spin:""},null,512),[[le,t(c).deletingAsset]]),e[40]||(e[40]=b(" Delete "))],8,cs)]),default:y(()=>{var o;return[l("div",is,[l("div",rs,[l("h3",ds,[e[38]||(e[38]=b(" Are you sure you want to delete the asset ")),l("strong",us,L((o=t(n))==null?void 0:o.name),1),e[39]||(e[39]=b("? "))])])])]}),_:1},8,["show"]),a(oe,{ref_key:"editAssetModalRef",ref:Be,show:t(se),header:{title:"Edit asset",theme:"blue"},type:"confirmation","modal-class":"modal-lg",onCancel:e[23]||(e[23]=()=>t(ce)())},{afterFooter:y(()=>[l("button",{ref:"cancelButton",class:"btn btnInfoBorderLight",onClick:e[22]||(e[22]=o=>t(Te)()),disabled:t(c).editingAsset},[_(a(i,{icon:["fas","spinner"],spin:""},null,512),[[le,t(c).editingAsset]]),e[48]||(e[48]=b(" Edit "))],8,xs)]),default:y(()=>{var o,v,f,X,Y;return[l("div",ms,[l("div",ps,[l("label",vs,[e[41]||(e[41]=b("Asset name: ")),a(i,{icon:["fas","circle-question"],title:"Asset name must be at least 3 characters long, alphanumeric and _ only."})]),_(l("input",{"onUpdate:modelValue":e[13]||(e[13]=u=>t(n).name=u),id:"edit-asset-name",type:"text",class:C(["form-control",{"is-invalid":t(n).name!==null&&!Q(t(n).name)}]),autocomplete:"off"},null,2),[[T,t(n).name]])]),l("div",fs,[e[43]||(e[43]=l("label",{class:"form-label",for:"edit-asset-type"},"Asset type:",-1)),_(l("select",{id:"edit-asset-type","onUpdate:modelValue":e[14]||(e[14]=u=>t(n).type=u),class:"form-control"},e[42]||(e[42]=[l("option",{value:"text"},"General",-1),l("option",{value:"password"},"Password",-1)]),512),[[pe,t(n).type]])])]),l("div",bs,[l("div",As,[e[44]||(e[44]=l("label",{class:"form-label",for:"edit-asset-value"},"Asset value:",-1)),t(n).type==="password"?_((B(),S("input",{key:0,id:"edit-asset-value","onUpdate:modelValue":e[15]||(e[15]=u=>t(n).value=u),type:"password",class:C(["form-control",{"is-invalid":t(n).value!==null&&((o=t(n).value)==null?void 0:o.trim())===""}]),autocomplete:"off"},null,2)),[[T,t(n).value]]):_((B(),S("textarea",{key:1,id:"edit-asset-value","onUpdate:modelValue":e[16]||(e[16]=u=>t(n).value=u),class:C(["form-control",{"is-invalid":((f=(v=t(n))==null?void 0:v.value)==null?void 0:f.length)>j}])},null,2)),[[T,t(n).value]]),l("small",{class:C(["form-text",((Y=(X=t(n))==null?void 0:X.value)==null?void 0:Y.length)>j?"text-danger":"text-muted"])}," 65k characters max. ",2)])]),l("div",gs,[l("div",ys,[e[45]||(e[45]=l("label",{class:"form-label",for:"processModifyAsset"},"Process:",-1)),a(t(F),{modelValue:t(V),"onUpdate:modelValue":e[17]||(e[17]=u=>A(V)?V.value=u:V=u),id:"processModifyAsset",options:t(H),multiple:!1,taggable:!1,"close-on-select":!0,placeholder:"--All--",label:"name","track-by":"id",onSelect:e[18]||(e[18]=u=>A(g)?g.value=null:g=null),onRemove:e[19]||(e[19]=u=>A(g)?g.value=null:g=null)},null,8,["modelValue","options"])]),l("div",ws,[e[46]||(e[46]=l("label",{class:"form-label",for:"instanceModifyAsset"},"Instance:",-1)),a(t(F),{modelValue:t(g),"onUpdate:modelValue":e[20]||(e[20]=u=>A(g)?g.value=u:g=u),id:"instanceModifyAsset",options:t(ee),multiple:!1,taggable:!1,"close-on-select":!0,placeholder:"--All--",label:"name","track-by":"id"},null,8,["modelValue","options"])])]),l("div",_s,[l("div",hs,[e[47]||(e[47]=l("label",{class:"form-label",for:"processCreateAsset"},"Users:",-1)),a(t(F),{modelValue:t(I),"onUpdate:modelValue":e[21]||(e[21]=u=>A(I)?I.value=u:null),id:"processCreateAsset",options:t(W),multiple:!0,taggable:!0,"close-on-select":!0,placeholder:t(W).length>0?"--All--":"No users available or no permitted to access them",label:"name","track-by":"id"},null,8,["modelValue","options","placeholder"])])])]}),_:1},8,["show"]),l("div",ks,[l("div",Vs,[a(We,{links:E})])]),l("div",Cs,[l("button",{onClick:e[24]||(e[24]=o=>A(D)?D.value=!0:D=!0),disabled:t(c).loadingAssets,class:"btn btn-green text-uppercase"},[a(i,{icon:["fas","circle-plus"]}),e[49]||(e[49]=b(" Add asset "))],8,Es)]),l("div",Ms,[l("div",Us,[l("div",Ps,[a(Xe,{title:"Assets"},{"create-button":y(()=>[l("span",{disabled:t(c).loadingAssets,onClick:e[25]||(e[25]=o=>Ce()),class:"pointer ms-2 btn btn-sm btnSuccessBorderLight"}," Add asset ",8,Bs)]),_:1}),l("div",Ss,[l("div",Ts,[l("div",Ns,[_(l("input",{type:"text",class:"form-control",placeholder:"Search asset","onUpdate:modelValue":e[26]||(e[26]=o=>A(z)?z.value=o:z=o),readonly:t(c).loadingAssets},null,8,Rs),[[T,t(z)]])])]),l("div",Ds,[l("div",Is,[t(c).loadingAssets?(B(),S("div",Ls,[a(i,{class:"mt-5",icon:["fas","spinner"],size:"2xl",spin:""})])):(B(),S("div",$s,[a(x,{items:t(ne),fields:[{key:"name",label:"Name"},{key:"users_count",label:"Users",thStyle:"width: 1%"},{key:"type",label:"Type",thStyle:"width: 1%"},{key:"value",label:"Value"},{key:"process.name",label:"Process"},{key:"instance.name",label:"Instance"},{key:"actions",label:"",thStyle:"width: 1%"}],"per-page":t(k),"current-page":t(R)},{"cell(type)":y(o=>[b(L(t(_e)(o.item)),1)]),"cell(value)":y(o=>[b(L(t(ye)(o.item)),1)]),"cell(process.name)":y(o=>{var v,f;return[b(L(((f=(v=o.item)==null?void 0:v.process)==null?void 0:f.name)||"All"),1)]}),"cell(instance.name)":y(o=>{var v,f;return[b(L(((f=(v=o.item)==null?void 0:v.instance)==null?void 0:f.name)||"All"),1)]}),"cell(users_count)":y(o=>{var v,f;return[l("span",Fs,L(((f=(v=o.item)==null?void 0:v.users)==null?void 0:f.length)||"-"),1)]}),"cell(actions)":y(o=>[l("a",Gs,[a(i,{icon:["fas","ellipsis"]})]),l("ul",zs,[l("li",qs,[l("button",{onClick:v=>t(Se)(o.item),class:"btn dropdown-item"},[a(i,{icon:["fas","edit"],class:"me-2"}),e[50]||(e[50]=b(" Edit asset "))],8,Ws),l("button",{onClick:v=>t(xe)(o.item),class:"btn dropdown-item text-theme"},[a(i,{icon:["fas","trash"],class:"me-2"}),e[51]||(e[51]=b(" Delete asset "))],8,Xs)])])]),_:1},8,["items","per-page","current-page"]),a(p,{class:"float-end mt-2",modelValue:t(k),"onUpdate:modelValue":e[27]||(e[27]=o=>A(k)?k.value=o:k=o),style:{width:"65px"},options:[5,10,15,20],onChange:e[28]||(e[28]=o=>t(je)(fe,t(k)))},null,8,["modelValue"]),a(U,{class:"mt-2",modelValue:t(R),"onUpdate:modelValue":e[29]||(e[29]=o=>A(R)?R.value=o:R=o),"per-page":t(k),"total-rows":t(be),"first-text":"First","prev-text":"Prev","next-text":"Next","last-text":"Last"},null,8,["modelValue","per-page","total-rows"])]))])])])])])])])}}});export{rt as default};
